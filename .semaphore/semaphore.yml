version: v1.0
name: "\U0001F48E Ruby CI Pipeline"
agent:
  machine:
    type: f1-standard-2
    os_image: ubuntu2004
fail_fast:
  stop:
    when: branch != 'master'
auto_cancel:
  running:
    when: branch != 'master'
  queued:
    when: branch = 'master'
global_job_config:
  prologue:
    commands:
      - checkout
      - sem-service start postgres 17
      - sem-service start redis 7
      - sem-version ruby 3.2.2
      - sem-version node 20.11.0
      - cache restore
      - yarn install --frozen-lockfile
      - bundle install --deployment --path vendor/bundle
blocks:
  - name: 'Block #1'
    dependencies: []
    task:
      jobs:
        - name: 'Job #1'
          commands:
            - echo "test"
  - name: 'Block #2'
    dependencies:
      - 'Block #1'
    task:
      jobs:
        - name: 'Job #1'
          commands:
            - echo test
  - name: 'Block #3'
    dependencies:
      - 'Block #1'
    task:
      jobs:
        - name: 'Job #1'
          commands:
            - echo test
  - name: 'Block #4'
    dependencies:
      - 'Block #2'
      - 'Block #3'
    task:
      jobs:
        - name: 'Job #1'
          commands:
            - echo test
after_pipeline:
  task:
    jobs:
      - name: "Merge Reports \U0001F4CA"
        commands:
          - test-results gen-pipeline-report
